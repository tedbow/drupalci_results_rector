Rector 0.8.x-dev@80f429b
Config file: rector.yml

[parsing] modules/contrib/abookings/abookings.module
[parsing] modules/contrib/abookings/includes/emails.inc
[parsing] modules/contrib/abookings/includes/queries.inc
[parsing] modules/contrib/abookings/includes/template_codes.inc
[parsing] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-events.php
[parsing] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-timezones.php
[parsing] modules/contrib/abookings/libraries/fullcalendar/demos/php/utils.php
[parsing] modules/contrib/abookings/modules/bookable_unit/bookable_unit.module
[parsing] modules/contrib/abookings/modules/bookable_unit/src/Tests/LoadTest.php
[parsing] modules/contrib/abookings/modules/booking/booking.module
[parsing] modules/contrib/abookings/modules/booking/includes/costs.inc
[parsing] modules/contrib/abookings/modules/booking/includes/form_manipulators.inc
[parsing] modules/contrib/abookings/modules/booking/includes/history.inc
[parsing] modules/contrib/abookings/modules/booking/src/Plugin/Deriver/BookingDeriver.php
[parsing] modules/contrib/abookings/modules/booking/src/Plugin/rest/resource/BookingRestResource.php
[parsing] modules/contrib/abookings/modules/booking/src/Tests/LoadTest.php
[parsing] modules/contrib/abookings/modules/bookings_backend/bookings_backend.module
[parsing] modules/contrib/abookings/modules/bookings_backend/src/Controller/BookingController.php
[parsing] modules/contrib/abookings/modules/bookings_backend/src/Controller/PromosController.php
[parsing] modules/contrib/abookings/modules/bookings_backend/src/Tests/LoadTest.php
[parsing] modules/contrib/abookings/modules/season/season.module
[parsing] modules/contrib/abookings/modules/season/src/Tests/LoadTest.php
[parsing] modules/contrib/abookings/src/Controller/BookPageController.php
[parsing] modules/contrib/abookings/src/Controller/BookingStatsPageController.php
[parsing] modules/contrib/abookings/src/Form/BookingEmailTemplatesForm.php
[parsing] modules/contrib/abookings/src/Form/BookingSettingsForm.php
[parsing] modules/contrib/abookings/src/Form/ManualEmailsForm.php
[parsing] modules/contrib/abookings/src/Tests/LoadTest.php
[parsing] modules/contrib/abookings/tests/src/Unit/ExampleConversionsTest.php
[refactoring] modules/contrib/abookings/abookings.module
[refactoring] modules/contrib/abookings/includes/emails.inc
[refactoring] modules/contrib/abookings/includes/queries.inc
[refactoring] modules/contrib/abookings/includes/template_codes.inc
[refactoring] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-events.php
[refactoring] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-timezones.php
[refactoring] modules/contrib/abookings/libraries/fullcalendar/demos/php/utils.php
[refactoring] modules/contrib/abookings/modules/bookable_unit/bookable_unit.module
[refactoring] modules/contrib/abookings/modules/bookable_unit/src/Tests/LoadTest.php
[refactoring] modules/contrib/abookings/modules/booking/booking.module
[refactoring] modules/contrib/abookings/modules/booking/includes/costs.inc
[refactoring] modules/contrib/abookings/modules/booking/includes/form_manipulators.inc
[refactoring] modules/contrib/abookings/modules/booking/includes/history.inc
[refactoring] modules/contrib/abookings/modules/booking/src/Plugin/Deriver/BookingDeriver.php
[refactoring] modules/contrib/abookings/modules/booking/src/Plugin/rest/resource/BookingRestResource.php
[refactoring] modules/contrib/abookings/modules/booking/src/Tests/LoadTest.php
[refactoring] modules/contrib/abookings/modules/bookings_backend/bookings_backend.module
[refactoring] modules/contrib/abookings/modules/bookings_backend/src/Controller/BookingController.php
[refactoring] modules/contrib/abookings/modules/bookings_backend/src/Controller/PromosController.php
[refactoring] modules/contrib/abookings/modules/bookings_backend/src/Tests/LoadTest.php
[refactoring] modules/contrib/abookings/modules/season/season.module
[refactoring] modules/contrib/abookings/modules/season/src/Tests/LoadTest.php
[refactoring] modules/contrib/abookings/src/Controller/BookPageController.php
[refactoring] modules/contrib/abookings/src/Controller/BookingStatsPageController.php
[refactoring] modules/contrib/abookings/src/Form/BookingEmailTemplatesForm.php
[refactoring] modules/contrib/abookings/src/Form/BookingSettingsForm.php
[refactoring] modules/contrib/abookings/src/Form/ManualEmailsForm.php
[refactoring] modules/contrib/abookings/src/Tests/LoadTest.php
[refactoring] modules/contrib/abookings/tests/src/Unit/ExampleConversionsTest.php
[printing] modules/contrib/abookings/abookings.module
[printing] modules/contrib/abookings/includes/emails.inc
[printing] modules/contrib/abookings/includes/queries.inc
[printing] modules/contrib/abookings/includes/template_codes.inc
[printing] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-events.php
[printing] modules/contrib/abookings/libraries/fullcalendar/demos/php/get-timezones.php
[printing] modules/contrib/abookings/libraries/fullcalendar/demos/php/utils.php
[printing] modules/contrib/abookings/modules/bookable_unit/bookable_unit.module
[printing] modules/contrib/abookings/modules/bookable_unit/src/Tests/LoadTest.php
[printing] modules/contrib/abookings/modules/booking/booking.module
[printing] modules/contrib/abookings/modules/booking/includes/costs.inc
[printing] modules/contrib/abookings/modules/booking/includes/form_manipulators.inc
[printing] modules/contrib/abookings/modules/booking/includes/history.inc
[printing] modules/contrib/abookings/modules/booking/src/Plugin/Deriver/BookingDeriver.php
[printing] modules/contrib/abookings/modules/booking/src/Plugin/rest/resource/BookingRestResource.php
[printing] modules/contrib/abookings/modules/booking/src/Tests/LoadTest.php
[printing] modules/contrib/abookings/modules/bookings_backend/bookings_backend.module
[printing] modules/contrib/abookings/modules/bookings_backend/src/Controller/BookingController.php
[printing] modules/contrib/abookings/modules/bookings_backend/src/Controller/PromosController.php
[printing] modules/contrib/abookings/modules/bookings_backend/src/Tests/LoadTest.php
[printing] modules/contrib/abookings/modules/season/season.module
[printing] modules/contrib/abookings/modules/season/src/Tests/LoadTest.php
[printing] modules/contrib/abookings/src/Controller/BookPageController.php
[printing] modules/contrib/abookings/src/Controller/BookingStatsPageController.php
[printing] modules/contrib/abookings/src/Form/BookingEmailTemplatesForm.php
[printing] modules/contrib/abookings/src/Form/BookingSettingsForm.php
[printing] modules/contrib/abookings/src/Form/ManualEmailsForm.php
[printing] modules/contrib/abookings/src/Tests/LoadTest.php
[printing] modules/contrib/abookings/tests/src/Unit/ExampleConversionsTest.php


15 files with changes
=====================

1) modules/contrib/abookings/abookings.module

    ---------- begin diff ----------
--- Original
+++ New
@@ -106,7 +106,7 @@
   $bookable = NULL;
   if (in_array('target_id', $bookable_nid_val[0])) {
     $bookable_nid = $bookable_nid_val[0]['target_id'];
-    $bookable = node_load($bookable_nid);
+    $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);
   }

   // If booking was confirmed
@@ -227,7 +227,7 @@

   $bookable_nid = $form_state->getValue('field_bookable_unit')[0]['target_id'];

-  $bookable = node_load($bookable_nid);
+  $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);

   $amount_due = get_booking_costs($booking)['amount_due'];
   // kint($amount_due, '$amount_due');
@@ -331,12 +331,12 @@

   // Loop through them
   foreach ($results as $rid => $nid) {
-    $booking = node_load($nid);
+    $booking = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
     $booking_time = $booking->getCreatedTime(); // string timestamp
     // kint($booking_time, '$booking_time');

     $bookable_nid = $booking->get('field_bookable_unit')->getValue()[0]['target_id'];
-    $bookable = node_load($bookable_nid);
+    $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);

     $deposit_email_sent = $booking->get('field_reminder_sent_deposit')->getValue()[0]['value'];

@@ -407,10 +407,10 @@

   // Loop through them
   foreach ($results as $rid => $nid) {
-    $booking = node_load($nid);
+    $booking = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);

     $bookable_nid = $booking->get('field_bookable_unit')->getValue()[0]['target_id'];
-    $bookable = node_load($bookable_nid);
+    $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);

     $checkout_date = $booking->get('field_checkout_date')->getValue()[0]['value'];
     // kint($checkout_date, '$checkout_date');
@@ -427,7 +427,7 @@

     $prearrival_hours = \Drupal::config('abookings.bookingsettings')->get('prearrival_hours');
     // kint($prearrival_hours, '$prearrival_hours');
-    $checkin_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $checkin_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d:H:i', $checkin_date . ':' . $checkin_time)->format('U');
     // kint($checkin_timestamp, '$checkin_timestamp');
     $prearrival_timestamp = intval($checkin_timestamp) - ($prearrival_hours * 60 * 60);
@@ -444,7 +444,7 @@

     // If past checkout time, complete the booking process

-    $checkout_date_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $checkout_date_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d:H:i', $checkout_date . ':' . $checkout_time)->format('U');
     // kint($checkout_date_timestamp, '$checkout_date_timestamp');
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


2) modules/contrib/abookings/includes/emails.inc

    ---------- begin diff ----------
--- Original
+++ New
@@ -3,12 +3,11 @@
  * @file
  * Contains emails abookings.module.
  */
-
 /**
  * CONTENTS
- * 
+ *
  * send_booking_email()
- * 
+ *
  * send_confirmation_email()
  * send_provis_booking_email()
  * send_prearrival_email()
@@ -16,7 +15,6 @@
  * send_expired_booking_email()
  * send_completed_booking_email()
  */
-
 use Drupal\node\Entity\Node;


@@ -92,7 +90,7 @@
   if ($result['result'] != true) {
     $message = t('There was a problem sending your email notification to @email, email key: @key.',
       array('@email' => $to, '@key' => $key));
-    drupal_set_message($message, 'error');
+    \Drupal::messenger()->addError($message);
     \Drupal::logger('mail-log')->error($message);
     return;
   }
@@ -99,7 +97,7 @@

   $message = t('An email notification has been sent to @email, email key: @key.',
     array('@email' => $to, '@key' => $key));
-  drupal_set_message($message);
+  \Drupal::messenger()->addStatus($message);
   \Drupal::logger('mail-log')->notice($message);
 }

@@ -339,4 +337,4 @@
     $notifn_emails_addresses_st, $email_key);

   log_email_to_history($booking, 'Booking completed; feedback asked for.');
-}
\ No newline at end of file
+}
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\DrupalSetMessageRector


3) modules/contrib/abookings/includes/queries.inc

    ---------- begin diff ----------
--- Original
+++ New
@@ -1,4 +1,5 @@
 <?php
+use Drupal\Core\Datetime\DrupalDateTime;
 /**
  * @file
  * Contains functions that query site data such as fetching bookings.
@@ -36,7 +37,7 @@

   // Save the array in the format: ['nid' => node].
   foreach ($results as $rid => $nid) {
-    $bookables[$nid] = node_load($nid);
+    $bookables[$nid] = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
   }
   // kint($bookables, '$bookables');

@@ -94,7 +95,7 @@

   // Loop through them
   foreach ($results as $rid => $nid) {
-    $promo = node_load($nid);
+    $promo = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
     // kint($promo, '$promo');

     // Check if code provided matches this promo's code
@@ -143,13 +144,13 @@
     // Get Start date as unix timestamp
     $start_iso_8601_date = $season->get('field_start_date')->get(0)
       ->getValue()['value'];
-    $start_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $start_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d', $start_iso_8601_date)->format('U'); // 'c'

     // Get End date as unix timestamp
     $end_iso_8601_date = $season->get('field_end_date')->get(0)
       ->getValue()['value'];
-    $end_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $end_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d', $end_iso_8601_date)->format('U'); // 'c'

     // Add season data to drupalSettings (for JS to use)
@@ -180,13 +181,13 @@
     // Get Check-in date as unix timestamp
     $checkin_iso_8601_date = $booking->get('field_checkin_date')->get(0)
       ->getValue()['value'];
-    $checkin_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $checkin_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d', $checkin_iso_8601_date)->format('U'); // 'c'

     // Get Check-out date as unix timestamp
     $checkout_iso_8601_date = $booking->get('field_checkout_date')->get(0)
       ->getValue()['value'];
-    $checkout_timestamp = \Drupal\Core\Datetime\DrupalDateTime
+    $checkout_timestamp = DrupalDateTime
       ::createFromFormat('Y-m-d', $checkout_iso_8601_date)->format('U'); // 'c'

     // Add booking data to drupalSettings (for JS to use)
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


4) modules/contrib/abookings/libraries/fullcalendar/demos/php/get-events.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -47,4 +47,4 @@
 }

 // Send JSON to the client.
-echo json_encode($output_arrays);
\ No newline at end of file
+echo json_encode($output_arrays);
    ----------- end diff -----------


5) modules/contrib/abookings/libraries/fullcalendar/demos/php/get-timezones.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -6,4 +6,4 @@
 // Requires PHP 5.2.0 or higher.
 //--------------------------------------------------------------------------------------------------

-echo json_encode(DateTimeZone::listIdentifiers());
\ No newline at end of file
+echo json_encode(DateTimeZone::listIdentifiers());
    ----------- end diff -----------


6) modules/contrib/abookings/modules/booking/booking.module

    ---------- begin diff ----------
--- Original
+++ New
@@ -138,9 +138,6 @@



-/**
- *
- */
 function get_line_items($booking_nid, $type) {
   $l_items = [];

@@ -160,7 +157,7 @@

   // Save the array in the format: ['nid' => node].
   foreach ($results as $rid => $nid) {
-    $l_items[$nid] = node_load($nid);
+    $l_items[$nid] = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
   }
   // kint($l_items, '$l_items');
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


7) modules/contrib/abookings/modules/booking/includes/form_manipulators.inc

    ---------- begin diff ----------
--- Original
+++ New
@@ -61,7 +61,7 @@


   $bookable_nid = \Drupal::config('abookings.bookingsettings')->get('bookable');
-  $bookable = node_load($bookable_nid);
+  $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);
   // kint($bookable, '$bookable');

   if (! in_array("/book", $build_info_args)) {
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


8) modules/contrib/abookings/modules/booking/src/Plugin/rest/resource/BookingRestResource.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -68,7 +68,7 @@
    * {@inheritdoc}
    */
   public function get($entity) {
-    $entity = (gettype($entity) === 'string') ? node_load($entity) : $entity;
+    $entity = (gettype($entity) === 'string') ? \Drupal::service('entity_type.manager')->getStorage('node')->load($entity) : $entity;
     return parent::get($entity);
   }

@@ -77,7 +77,7 @@
    */
   public function post($entity = NULL) {
     // kint($entity, '$entity');
-    $entity = (gettype($entity) === 'string') ? node_load($entity) : $entity;
+    $entity = (gettype($entity) === 'string') ? \Drupal::service('entity_type.manager')->getStorage('node')->load($entity) : $entity;
     return parent::post($entity);
   }

@@ -85,7 +85,7 @@
    * {@inheritdoc}
    */
   public function delete($entity) {
-    $entity = (gettype($entity) === 'string') ? node_load($entity) : $entity;
+    $entity = (gettype($entity) === 'string') ? \Drupal::service('entity_type.manager')->getStorage('node')->load($entity) : $entity;
     return parent::delete($entity);
   }

@@ -93,7 +93,7 @@
    * {@inheritdoc}
    */
   public function patch($original_entity, $entity = NULL) {
-    $entity = (gettype($entity) === 'string') ? node_load($entity) : $entity;
+    $entity = (gettype($entity) === 'string') ? \Drupal::service('entity_type.manager')->getStorage('node')->load($entity) : $entity;
     return parent::patch($original_entity, $entity);
   }
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


9) modules/contrib/abookings/modules/bookings_backend/bookings_backend.module

    ---------- begin diff ----------
--- Original
+++ New
@@ -76,4 +76,4 @@
   // kint($cache, '$cache');

   $output['#attached']['library'][] = 'bookings_backend/booking_views';
-}
\ No newline at end of file
+}
    ----------- end diff -----------


10) modules/contrib/abookings/modules/bookings_backend/src/Controller/BookingController.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -126,13 +126,13 @@
       array('%type' => $booking->getEntityTypeId(), '%id' => $booking->id()));

     $bookable_nid = $booking->get('field_bookable_unit')->getValue()[0]['target_id'];
-    $bookable = node_load($bookable_nid);
+    $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);

     send_provis_booking_email($booking, $bookable);

     // Prepare the response

-    $url = $booking->urlInfo('canonical', ['absolute' => TRUE])->toString(TRUE);
+    $url = $booking->toUrl('canonical', ['absolute' => TRUE])->toString(TRUE);
     // $response = new ModifiedResourceResponse($booking, 201, [
     //   'Location' => $url->getGeneratedUrl()
     // ]);
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\EntityInterfaceUrlInfoRector
 * DrupalRector\Rector\Deprecation\NodeLoadRector


11) modules/contrib/abookings/modules/season/season.module

    ---------- begin diff ----------
--- Original
+++ New
@@ -1,5 +1,6 @@
 <?php

+use Drupal\Core\Form\FormStateInterface;
 /**
  * @file
  * Contains season.module.
@@ -36,7 +37,7 @@
  * Implements hook_form_FORM_ID_alter().
  */
 function season_form_node_season_edit_form_alter(&$form,
-  \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
+  FormStateInterface $form_state, $form_id) {
   $form['#validate'][] = 'validate_season';
 }
    ----------- end diff -----------


12) modules/contrib/abookings/src/Controller/BookingStatsPageController.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -2,6 +2,7 @@

 namespace Drupal\abookings\Controller;

+use Drupal\Core\Datetime\DrupalDateTime;
 use Drupal\Core\Controller\ControllerBase;

 /**
@@ -76,7 +77,7 @@
   $current_timestamp = time();
   // $timezone = drupal_get_user_timezone();
   // kint($timezone, '$timezone');
-  $datetime = \Drupal\Core\Datetime\DrupalDateTime
+  $datetime = DrupalDateTime
     ::createFromFormat('U', $current_timestamp);
   // drupal_set_message(t('1'), 'status', FALSE);

@@ -181,7 +182,7 @@

     $nodes = [];
     foreach ($results as $rid => $nid) {
-      $booking = node_load($nid);
+      $booking = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
       $nodes[$nid] = [
         'checkin_date'  => $booking->get('field_checkin_date')->getValue()[0]['value'],
         'checkout_date' => $booking->get('field_checkout_date')->getValue()[0]['value'],
@@ -189,7 +190,7 @@
     }
     // kint($nodes, '$nodes');

-    $i_date = \Drupal\Core\Datetime\DrupalDateTime
+    $i_date = DrupalDateTime
       ::createFromFormat('Y-m-d', $dates_pair[1]);
     $start_month = intval($i_date->format('n'));
     $start_year = intval($i_date->format('Y'));
@@ -245,7 +246,7 @@

     $total = 0;
     foreach ($results as $rid => $nid) {
-      $booking = node_load($nid);
+      $booking = \Drupal::service('entity_type.manager')->getStorage('node')->load($nid);
       $booking_base_cost = $booking->get('field_base_cost')->getValue();
       if (array_key_exists(0, $booking_base_cost)) {
         $total += floatval($booking_base_cost[0]['value']);
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


13) modules/contrib/abookings/src/Form/BookingSettingsForm.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -119,7 +119,7 @@
     // Validate site bookable unit
     $bookable_nid = $form_state->getValue('bookable');
     if ($bookable_nid) {
-      $bookable = node_load($bookable_nid);
+      $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);
       if (! $bookable) {
         $form_state->setErrorByName('bookable',
           $this->t("No bookable unit was found with that ID."));
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


14) modules/contrib/abookings/src/Form/ManualEmailsForm.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -29,7 +29,7 @@
     $booking = $form_state->getBuildInfo()['args'][0];
     // kint($booking, '$booking');
     $bookable_nid = $booking->get('field_bookable_unit')->getValue()[0]['target_id'];
-    $bookable = node_load($bookable_nid);
+    $bookable = \Drupal::service('entity_type.manager')->getStorage('node')->load($bookable_nid);

     $codes = get_all_codes_values($booking, $bookable);
    ----------- end diff -----------


Applied rules:

 * DrupalRector\Rector\Deprecation\NodeLoadRector


15) modules/contrib/abookings/tests/src/Unit/ExampleConversionsTest.php

    ---------- begin diff ----------
--- Original
+++ New
@@ -35,4 +35,4 @@
     $this->assertEquals(12, 11 + 1);
   }
  
-}
\ No newline at end of file
+}
    ----------- end diff -----------


 [OK] Rector is done! 15 files have been changed.                               

